
@{
    ViewData["Title"] = "FirstAjax";
}

<h1>FirstAjax</h1>
<input type="text" placeholder="user name" id="inputName" />
<input type="number" placeholder="user age" id="inputAge"/>
<input type="button" value="Load" id="button1" />
<div id="div1"></div>

@section Scripts{
    <script>
        const btn = document.querySelector('#button1');
        const divMessage = document.querySelector('#div1');
        const txtName = document.querySelector('#inputName');
        const txtAge = document.querySelector('#inputAge');
        btn.addEventListener('click', () => {
            //步驟一建立Ajax物件
            const xhr = new XMLHttpRequest();

            //步驟三接收伺服器回傳的結果(Response)
            //load事件表示伺服器已經回傳結果到Client端了
            xhr.addEventListener("load", () => {
                //接收結果
                const data = xhr.responseText;
                //顯示在div中
                divMessage.innerHTML = data;
                console.log("load")
            })
            //ajax 開始
            xhr.addEventListener('loadstart', () => {
                console.log("loadstart")
                btn.value = "loading...";
                btn.setAttribute('disabled', 'disabled');
            })
            //ajax 結束
            xhr.addEventListener('loadend', () => {
                console.log("loadend")
                btn.value = "Load";
                btn.removeAttribute('disabled');
            })

            //步驟二對伺服器發出要求(Request)
            xhr.open("GET", `/api/index?userName=${txtName.value}&age=${txtAge.value}`); //打開瀏覽器輸入網址
            xhr.send(); //Enter鍵

        })






    </script>
}


